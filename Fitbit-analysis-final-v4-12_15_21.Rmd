---
title: "Fitbit-analysis-v4-12_15_21"
author: "Keshav Sompura"
date: "12/15/2021"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: FALSE
    fig_height: 5
    fig_width: 7
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# load libraries
library(tidyverse)
library(skimr)
library(lubridate)
library(printr)
library(patchwork)
library(gghighlight)
library(ggpubr)
library(corrplot)
library(padr)
library(plotly)
library(htmlwidgets)
library(widgetframe)
```

## Questions to Guide Analysis
1. What are some trends in smart device usage?
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat market strategy?

### Deliverables
1. A clear summary of the business task
2. A description of all data sources used
3. Documentation of any cleaning or manipulation of data
4. A summary of your analysis
5. Supporting visualizations and key findings
6. Your top high-level content recommendations based on your analysis


### Product of focus
* Time: This wellness watch combines the timeless look of a classic timepiece with smart technology to track user activity, sleep, and stress. The Time watch connects to the Bellabeat app to provide you with insights into your daily wellness.

# Ask

### What is the problem being solved?

* Sršen wants to reveal more opportunities for growth. 
* She wants my team to use data to gain insight into how people are already using their smart devices.
* She then wants high-level recommendations for how these trends can inform Bellabeat marketing strategy.


### How can data insights drive business decisions?

My insights can show the stakeholders what their market looks like, which can help them to build data driven marketing campaigns which better target their users needs and actions. The insights can also help to find areas that the product can be improved on which will in-turn lead to a better product, which could drive growth.

### Identify the business task
Use data to show how people are already using their smart devices to better understand the market.

### Consider the key stakeholders

* Urška Sršen: Bellabeat’s cofounder and Chief Creative Officer.
* Sando Mur: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team.
* Bellabeat marketing analytics team: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.

The report must be high-level enough that the cofounders get a general sense of the market. The analytics team can understand more of the statistics side of any finding so it may be worth while to include any findings in the report.

# Prepare

### Data Used

The data that will be used in this report was taken from [Kaggle](https://www.kaggle.com/arashnic/fitbit):
"FitBit Fitness Tracker Data
Pattern recognition with tracker data: : Improve Your Overall Health"
Authored by Mobius and originally "generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring."

This data is publicly available from [zendo.org](https://zenodo.org/record/53894#.YbD9ntDMI2y).

Furberg, R., Brinton, J., Keating, M., & Ortiz, A. (2016). Crowd-sourced Fitbit datasets 03.12.2016-05.12.2016 [Data set]. Zenodo. https://doi.org/10.5281/zenodo.53894

### Data Integrity

Because this data is not sourced from Bellabeat, its reliability is questionable and not original to the company.
This data set also does not contain details such as gender, location, age, or fitness ability which makes the dataset less transparent an open to potential bias.

This data is somewhat current as it is from 2016, which is not long enough for a large shift in the overall fitness of society as a whole. However, it is important to note that wearable activity trackers have become more common place since 2016 so we might see a more general observation of people's fitness behavior if a more recent dataset were available.

### Import the Data (Hypothesis)

I will be using the **minutely sleep and heart rate** data as well as the **hourly calorie, intensity, and step** data as I am most interested in how people act during each hours of the day. 

I hypothesize that there exists overall trends during certain hours of the day which will differ between days of the week.



```{r load in data}
# import the data in
calories <-  read_csv("./data/hourlyCalories_merged.csv")
intensities <- read_csv("./data/hourlyIntensities_merged.csv")
steps <-  read_csv("./data/hourlySteps_merged.csv")
sleep_min <- read_csv("./data/minuteSleep_merged.csv")
heart_rate <- read_csv("./data/heartrate_seconds_merged.csv")
```


### Take a quick look and summary of the data
```{r}
# look for any missing values and data types

# sleep overview, 
sleep_min %>% skim_without_charts()

# calorie overview
calories %>% skim_without_charts()

# intensity overview
intensities %>% skim_without_charts()

# step overview
steps %>% skim_without_charts()

# summary
calories[,-c(1,2)] %>% summary()
intensities[,-c(1,2)] %>% summary()
steps[,-c(1,2)] %>% summary()
heart_rate[,-c(1,2)] %>% summary()
```
* On average, people burn about 83 calories an hour. We likely want to consider the median instead of the mean because the data seems to be greatly skewed to the right, as the max amount of calories burned in an hour is much greater than the mean and 3rd quantile.

* Because the `TotalIntensity` feature was not described in detail, I will make the assumption that it is acting as a measure of physical intensity and activtiy during the hour. Total intensity also seems to be right skewed based on the difference between the 3rd quartile and the maximum value.

* The median amount of steps taken an hour is 40, which is very low. Bellabeat may want to consider adding an optional feature to send reminder at a set interval to get up and move. This could be made into a dynamic goal bar to take 100 steps at every interval. 

```{r}
# see how many unique users are in each dataset
n_calories <- calories %>% summarise(num_users = n_distinct(Id))
n_intensities <- intensities %>% summarise(num_users = n_distinct(Id))
n_sleep <- sleep_min %>% summarise(num_users = n_distinct(Id))
n_steps <- steps %>% summarise(num_users = n_distinct(Id))
n_hr <- heart_rate %>% summarise(num_users = n_distinct(Id))

num_users <- bind_rows(n_calories, n_intensities, n_sleep, n_steps, n_hr)
num_users <- as.data.frame(num_users)
rownames(num_users) <- c("calories","intensities","sleep","steps", "heart rate")
num_users 
```
There were 33 unique individuals in the calorie, intensity, and step dataset, but only 24 unique individuals in the sleep dataset and only 14 unique individuals in the heart rate dataset. Because we do not know how the experiment was conducted, it is impossible to say, however, the lower number of individuals who monitored their sleep could indicate that there exists a group of people do not like sleeping with a fitbit watch on. This could potentially indicate an opportunity to create a product that is more comfortable during sleep.

# Process

* Clean the data and get it ready to be usable. 
* Identify any errors in the data
* Join the data for analysis

### Join and Prepare the Data

Join the hourly data sets on `Id` and `ActivityHour` because all the hourly data sets (calories, steps, and intensities) have the same number of unique participants. 

Simplify the Ids for hourly datasets for easier exploration. 

Make `ActivityHour` into date and time variables for analysis.

```{r}

# join all hourly datasets on by Id and by the "day and time"
id_join <- merge(calories, steps, by = c("Id", "ActivityHour"), all = TRUE)

id_join <- merge(id_join, intensities, by = c("Id", "ActivityHour"), all = TRUE)

# simplify Id for easier analysis
clean_join <-  id_join %>% 
  group_by(Id) %>% 
  dplyr::mutate(Id = cur_group_id())

# make Id a factor that can be analysed instead of numeric
clean_join$Id <- as.factor(clean_join$Id)

# make the character variable "ActivityHour" into a date-time variable
day_hr <- mdy_hms(clean_join$ActivityHour)
clean_join$day_hr <- day_hr
id_join$day_hr <- day_hr

# remove old ActivityHour variable
clean_join <- clean_join[-2]

# add on hour and day of week variables
clean_join <-  clean_join %>% 
  mutate(hour_of_day = hour(day_hr),
         day_of_week = weekdays(day_hr))

# put the days in order
clean_join$day_of_week = factor(clean_join$day_of_week,
                                levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
```

### Clean Sleep Data

Check to see the number of total unique sleep sessions.

Group the observations by hour.

Convert the `date` feature from a character class to a date class and extract the day of the week and the hour of the day into separate features.

There are missing data between sleep sessions, so to get a more interpretable model I will set the missing hours to a 0 value to indicate the individual was awake during those hours.

* It is important to note that there are missing days in the data that will have all their hours set to 0. I am making the assumption a universal decrease over all hours of those days will not greatly impact the results of the analysis because they make up only a small fraction of the total number of observations. This will slightly scale down the results.

```{r}
## check to see if there are the same number of Id and logId
sleep_min %>% summarise(num_users_id = n_distinct(Id),
                        num_users_logid = n_distinct(logId)) 
# each logId represents a sleep session

day_time <- mdy_hms(sleep_min$date)
sleep_min$day_time <- day_time


# group by hours and sum values
sleep_hour <- sleep_min %>% 
  thicken(interval = "hour") 

sleep_hour <- sleep_hour %>% 
  group_by(Id,day_time_hour) %>%
  summarise(total_sleep_val = sum(value))

# fill in missing hours with 0 to represent being awake
sleep_hour <- sleep_hour %>% 
  pad(group = "Id") %>% 
  fill_by_value()


# make hour and date variables
sleep_hour <- sleep_hour %>% 
  mutate(hour_of_day = hour(day_time_hour),
         day_of_week = weekdays(day_time_hour),
         month_day_yr = date(day_time_hour))

# put days of week in order
sleep_hour$day_of_week = factor(sleep_hour$day_of_week,
                                levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
```

### Clean Heart Rate Data
Group the observations by hour.

Convert the `date` feature from a character class to a date class and extract the day of the week and the hour of the day into separate features.


```{r}
# clean heart rate data
heart_clean <- heart_rate

hr_day_time <- mdy_hms(heart_clean$Time)
heart_clean$day_time <- hr_day_time

heart_clean <- heart_clean %>%
  thicken(interval = "hour")

# group by hour and find the hourly mean heart rate for each individual
heart_clean <- heart_clean %>%
  group_by(Id,day_time_hour) %>%
  summarise(mean_heart_rate = mean(Value))

# Check how many unique individuals there are and how many entries they have
heart_clean %>% count(num_users_id = n_distinct(Id))

heart_clean <- heart_clean %>% 
  mutate(hour_of_day = hour(day_time_hour),
         day_of_week = weekdays(day_time_hour),
         month_day_yr = date(day_time_hour))


heart_clean$day_of_week = factor(heart_clean$day_of_week,
                                levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
```

### Join sleep and heart rate data on other hourly dataset

Rename variables to make join possible.

Join the cleaned sleep and heart rate data on `Id` and `day_hr` variables.

```{r}
# join hourly sleep and heart rate on the other data set
sleep_join <- sleep_hour %>% 
  rename(day_hr = day_time_hour)
heart_join <- heart_clean %>% 
  rename(day_hr = day_time_hour)

all_join <- sleep_join %>% 
  inner_join(id_join, by = c("Id","day_hr"))
all_join <- heart_join %>% 
  inner_join(all_join, by = c("Id","day_hr"))
```


### Look for Outlier Individuals

Find out if anyone did not enter the same amount of days and hours. That could skew the results by leaving in people that did not complete the experiment.
```{r}
clean_join %>% 
  group_by(Id) %>% 
  count(Id) %>% 
  arrange(n) %>% 
  ggplot()+
  geom_col(aes(x = reorder(Id, n), y = n))+
  xlab("Individual")+
  ylab("Number of Hourly Observations")+
  ggtitle("Hourly Observations by Individual")
```

There are a number of individuals that do not have the same number of entries. It might be worth while to remove the individuals who do not have roughly the same number of entries. 

I will leave these individuals in during the analysis because their records are by hours, not days so they will still provide insight into hourly trends.




# Analyze

### Frequency: Calories Burned per Hour
```{r}
# how many calories are burned in an hour
p_cal_count <- calories %>% 
ggplot(mapping = aes(x= Calories, y = ..count..)) +
  geom_histogram(fill = "#f9dede", color = "black", binwidth = 20, boundary = 0)+
  scale_x_continuous(breaks=seq(0, max(calories$Calories), 100))+
  ggtitle("Calories Burned in an Hour")+
  labs(x = "Calories Burned",
       y = "Number of Observations")
  
ggplotly(p_cal_count)

# html widget incase it plotly breaks
# ptly_cal_count <- ggplotly(p_cal_count)

# save(ptly_cal_count, file = "./widgets/ptly_cal_count.rdata")
# load("./widgets/ptly_cal_count.rdata")
# widgetframe::frameWidget(ptly_cal_count)
```


The majority of hours, people burn around 150 calories or less. As the amount of calories burned in an hour increase, the number of observations dramatically decreases.

The amount of calories burned an hour is right skewed so using the median value will provide a more accurate approximation.

* It is important to note that many hours of the day are spent sleeping, which likely account for a number of the low hourly observations.

### Frequency: Steps Taken per Hour
```{r}
# number of steps taken in an hour
steps$condition <- factor(steps$StepTotal < 500, c(TRUE,FALSE),
                          c("Less than 500 Steps", "Greater than 500 Steps"))
p_step_count <- steps %>%
  ggplot(aes(x = StepTotal), scale = "free")+
  geom_histogram(binwidth = 100, fill = "#f9dede", color = "black")+
  ggtitle("Steps Taken in an Hour")+
  labs(x = "Steps per Hour",
       y = "Number of Observations")
 # facet_grid(~condition, scales = "free")
  
ggplotly(p_step_count)
```

Proportionally, the low to minimal amount of steps taken per hour is very high. This to me is very shocking, yet not surprising given that only around 22% of people meet the weekly fitness standard as reported by the Centers for Disease Control [(CDC)](https://www.cdc.gov/nchs/data/nhsr/nhsr112.pdf).

The data is skewed to the right as we can see from the graphs above. This indicates using the median instead of mean will provide a more accurate insight.

* It is important to note that many hours of the day are spent sleeping, which likely account for a number of the low hourly observations.

### Frequency: Intensity per Hour
```{r}
# Total Intensity in an hour
p_intentsity_count <- intensities %>% 
  ggplot(aes(x = TotalIntensity))+
  geom_histogram(bins = 25, fill = "#f9dede", color = "black")+
  scale_x_continuous(breaks=seq(0, max(steps$StepTotal), 20))+
  ggtitle("Total Intensity in an Hour")+
  labs(x = "Intensity per Hour",
       y = "Number of Observations")
 

ggplotly(p_intentsity_count)
```

The majority of people spend their time in a low physically intensive manner.

This data is skewed to the right, indicating the median will be more insightful than the mean.

* It is important to note that many hours of the day are spent sleeping, which likely account for a number of the low hourly observations.


### Hourly Trends: Calories
```{r}
# see which hours people generally burn more calories
  
p_med_cal_hr <-  clean_join %>% 
  group_by(hour_of_day) %>% 
  summarize(median_calories = median(Calories)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = median_calories))+
  ylab("Calories")+
  theme(axis.title.x = element_blank())

p_cal_hr <-  clean_join %>% 
  group_by(hour_of_day) %>% 
  ggplot()+
  geom_smooth(mapping = aes(x = hour_of_day, y = Calories))+
  xlab("Hour of Day")
  
# Graph
cal_patch <- (p_med_cal_hr / p_cal_hr) &
  scale_x_continuous(breaks = scales::pretty_breaks(n = 12))

cal_patch + plot_annotation(
  title = "Calories Burned by Hour",
  subtitle = "Top: Median; Bottom: Conditional Mean (Confidence Interval: 95%)"
)
```

On average, most people burn a low amount of calories during the normal sleeping hours, which is expected. 

One somewhat unexpected insight that can be taken away is there seems to be a decrease in the calories burned from around 1 - 3pm. Some people may know this anecdotally, but it could be good to send a reminder to users around that time to get up and take a short walk to re-energized and improve the quality of their day.

Another thing that can be observed is the peak in calories burned around 6pm, which may indicate that people exercise more after in the evening when they are finished with their job or their daily studying. 





### Hourly Trends: Steps
```{r}
# see which hours people generally take more steps
p_med_step_hr <-  clean_join %>% 
  group_by(hour_of_day) %>% 
  summarize(median_steps = median(StepTotal)) %>%
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = median_steps))+
  ylab("Steps")+
  theme(axis.title.x = element_blank())

p_step_hr <-  clean_join %>% 
  group_by(hour_of_day) %>% 
  ggplot()+
  geom_smooth(mapping = aes(x = hour_of_day, y = StepTotal))+
  xlab("Hour of Day")+
  ylab("Steps")

# Graph
step_patch <- (p_med_step_hr / p_step_hr) &
  scale_x_continuous(breaks = scales::pretty_breaks(n = 12))

step_patch + plot_annotation(
  title = "Steps Taken by Hour",
  subtitle = "Top: Median; Bottom: Conditional Mean (Confidence Interval: 95%)"
)
```

A similar trend to the calorie graph is observed. We can see that between the hours of 11pm and 6am people tend to not move around, which is expected as they would be asleep or in bed. 

Again, we can see a dip in activity from around 1 - 4pm followed by an increase in activity around 6pm.



### Hourly Trends: Intensity
```{r}
# see which hours people have the most total intensity
p_med_int_hr <- clean_join %>% 
  group_by(hour_of_day) %>% 
  summarize(median_intensity = median(TotalIntensity)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = median_intensity))+
  theme(axis.title.x = element_blank())+
  ylab("Intensity")

p_int_hr <- clean_join %>% 
  group_by(hour_of_day) %>% 
  ggplot(mapping = aes(x = hour_of_day, y = TotalIntensity))+
  geom_smooth()+
  xlab("Hour of Day")+
  ylab("Intensity")

# Graph
int_patch <- (p_med_int_hr / p_int_hr) &
  scale_x_continuous(breaks = scales::pretty_breaks(n = 12))

int_patch + plot_annotation(
  title = "Intensity by Hour",
  subtitle = "Top: Median; Bottom: Conditional Mean (Confidence Interval: 95%)"
)
```

Intensity in this dataset is used as a measure of physical activity. We can see a steadily increasing trend in activity from 6am to noon followed by a decline until 3pm. 

This graph shows the pronounced afternoon slump in activity people experience.

We can also see that the average hours of most activity are 5pm and 6pm.


### Hourly Trends: Sleep
```{r}
# graph sleep trends
p_mean_sleep_hr <- sleep_hour %>% 
  group_by(hour_of_day) %>% 
  summarize(mean_sleep_val = mean(total_sleep_val)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = mean_sleep_val))+
  theme(axis.title.x = element_blank())+
  ylab("Sleep Value")
  

p_sleep_hr <- sleep_hour %>% 
  group_by(hour_of_day) %>% 
  ggplot(mapping = aes(x = hour_of_day, y = total_sleep_val))+
  geom_smooth()+
  xlab("Hour of Day")+
  ylab("Sleep Value")

sleep_patch <- (p_mean_sleep_hr / p_sleep_hr) &
  scale_x_continuous(breaks = scales::pretty_breaks(n = 12))

sleep_patch + plot_annotation(
  title = "Sleep by Hour",
  subtitle = "Top: Mean; Bottom: Conditional Mean (Confidence Interval: 95%)"
)
```

Sleep Value acts in the above graphs as a measure of sleep and sleep quality, 0 representing being awake. 

The graph shows the very steady sloping sleep trends people, on average, experience; with the highest quality sleep occurring between the hours of 2am and 5am.


### Hourly Trends: Heart Rate
```{r}
# median hr over the day
p_mean_heart_hr <-  heart_clean %>% 
  group_by(hour_of_day) %>% 
  summarize(mean_hr = mean(mean_heart_rate)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = mean_hr))+
  theme(axis.title.x = element_blank())+
  ylab("Heart Rate")


p_heart_hr <- heart_clean %>% 
  group_by(hour_of_day) %>%
  ggplot(mapping = aes(x = hour_of_day, y = mean_heart_rate))+
  geom_smooth()+
  xlab("Hour of Day")+
  ylab("Heart Rate")
  
heart_patch <- (p_mean_heart_hr/p_heart_hr) &
  scale_x_continuous(breaks = scales::pretty_breaks(n = 12))

heart_patch + plot_annotation(
  title = "Heart Rate by Hour",
  subtitle = "Top: Mean; Bottom: Conditional Mean (Confidence Interval: 95%)"
)

```

People's heart rate seems to be fairly steady during awake hours, yet we see that there is again a low point during the day around 3pm. This may result in an alertness decline which would be relevant for people to realize. Reminding users would allow them become more self-aware, giving them a chance to find a way to re-energize, do tasks of lower importance, practice mindfulness, etc. around that time.

One observation to note, people on average, experience elevated heart rate from 4pm to 7pm which may indicate hours of exercise or activity. 

Another thing to notice, people have a significantly lower heart rate around 3am to 4am followed by a sharp increase. This may indicate a deeper sleep right before waking. More research should be conducted, but a recommendation could be made that it is important to get into a regular sleep routine and wake without an alarm, which could improve the quality of life someone experiences during the day.


### Correlations

Find how the different features interact with one another.

Some variables might increase together. Other variables might increase as another decreases.

```{r}
## overlay median steps, calories, and intensity to see their correlation

# calories and intensity
clean_join %>% 
  ggscatter(x = "TotalIntensity", y = "Calories",
            add = "reg.line", conf.int = TRUE,
            cor.coef = TRUE, cor.method = "pearson",
            alpha = 0.2)+
  xlab("Intensity")+
  ggtitle("Correlation: Intensity vs Calories Burned")
  
  
  

# steps and intensity
clean_join %>% 
  ggscatter(x = "StepTotal", y = "TotalIntensity",
            add = "reg.line", conf.int = TRUE,
            cor.coef = TRUE, cor.method = "pearson",
            alpha = 0.2)+
  xlab("Steps")+
  ylab("TotalIntensity")+
  ggtitle("Correlation: Steps Taken vs Intensity")

# steps and calories
clean_join %>% 
  ggscatter(x = "StepTotal", y = "Calories",
            add = "reg.line", conf.int = TRUE,
            cor.coef = TRUE, cor.method = "pearson",
            alpha = 0.2)+
  xlab("Steps")+
  ggtitle("Correlation: Steps Taken vs Calories Burned")



```

Intensity is the correlated the most with steps taken and calories burned in an hour (both having 0.9 correlation). This means, there is a very strong positive relationship between physical intensity and calories burned and steps taken. As physical intensity increases, the calories burned and steps taken also tend to increase.  

```{r}
# make correlation matrix
all_cor_matrix <- all_join %>% 
  select(Calories,StepTotal, TotalIntensity, mean_heart_rate, total_sleep_val)
all_cor_matrix$Id <- NULL
all_cor_matrix <- cor(all_cor_matrix)

corrplot(all_cor_matrix, addCoef.col = "white", col = COL2("RdBu",10))
```


Heart rate does have a positive relationship with amount of calories burned, steps taken, and physical intensity.

Sleep has a negative relationship with all the other variables, which is expected because in the hours people sleep they are less physically active.


### Weekday Trends

Find trends that occur during separate days of the week.

```{r}
# use total intensity because it has the highest correlation with steps and calories

clean_join %>% 
  group_by(day_of_week, hour_of_day) %>% 
  summarize(median_intensity = median(TotalIntensity)) %>%
  ggplot()+
  geom_line(mapping = aes(x = hour_of_day, y = median_intensity, color = day_of_week), size = 2)+
  gghighlight(unhighlighted_params = list(size = 1, alpha = 0.6))+
  facet_wrap(~day_of_week)+
  scale_x_continuous(breaks = c(2,6,10,14,18,22))+
  xlab("Hour of Day")+
  ylab("Intensity")+
  ggtitle("Hourly Trends of Physical Intensity", subtitle = "By Weekday")
```


Saturday seems to be very different from the other days of the week. People are much more active on Saturday mornings and afternoons than the other days of the week. The evening activity on Saturdays and Sundays is lower than the other days of the week.

There is a peak in activity around noon primarily on Tuesdays, Wednesdays, and Fridays. 

* Physical intensity is used also as proxy for calories burned and steps taken as it was highly correlated with both.


```{r}
# hourly sleep trends by day
sleep_hour %>% 
  group_by(day_of_week, hour_of_day) %>% 
  summarise(mean_sleep_val = mean(total_sleep_val)) %>% 
  ggplot(mapping = aes(x = hour_of_day, y = mean_sleep_val, color =day_of_week))+
  geom_line(size = 2)+
  gghighlight(unhighlighted_params = list(size = 1))+
  facet_wrap(~day_of_week)+
  scale_x_continuous(breaks = c(2,6,10,14,18,22))+
  xlab("Hour of Day")+
  ylab("Sleep Value")+
  ggtitle("Hourly Trends of Sleep", subtitle = "By Weekday")
  

sleep_hour %>% 
  group_by(day_of_week, hour_of_day) %>% 
  summarise(mean_sleep_val = mean(total_sleep_val)) %>% 
  ggplot(mapping = aes(x = hour_of_day, y = mean_sleep_val, color =day_of_week))+
  geom_line(size = 2)+
  scale_y_continuous(trans = "sqrt")+
  gghighlight(unhighlighted_params = list(size = 1))+
  facet_wrap(~day_of_week)+
  scale_x_continuous(breaks = c(2,6,10,14,18,22))+
  xlab("Hour of Day")+
  ylab("Sleep Value")+
  ggtitle("Hourly Trends of Sleep", subtitle = "By Weekday")

```

The second set of sleep graphs zooms in on midday sleep. On Saturday and Sunday around 3pm, we can see that people tend to fall asleep more frequently, i.e., they take a midday nap more than on the other days of the week. This is consistent with the dips in activity and heart rate in the afternoon as shown previously.

People tend to get tired around 3pm.

Interestingly, on Thursday and Friday people seem to sleep the least around 3pm.


```{r}
# heart rate by hour by day
heart_clean %>% 
  group_by(day_of_week, hour_of_day) %>% 
  summarise(mean_hr = mean(mean_heart_rate)) %>% 
  ggplot(aes(x = hour_of_day, y = mean_hr, color = day_of_week))+
  geom_line(size = 2)+
  gghighlight(unhighlighted_params = list(size = 1))+
  facet_wrap(~day_of_week)+
  scale_x_continuous(breaks = c(2,6,10,14,18,22))+
  xlab("Hour of Day")+
  ylab("Heart Rate")+
  ggtitle("Hourly Trends of Heart Rate", subtitle = "By Weekday")

```

The first three working days (Monday, Tuesday, Wednesday) seem to experience the afternoon slump the most relative to the other days of the week. 

Saturday by contrast, has the highest average heart rate in the afternoon.

# Conclusion

**High level recommendations:**
People on average tend to experience an afternoon slump in activity and [alertness](https://smhs.gwu.edu/news/gw-researcher-discovers-mechanisms-link-brain-alertness-and-increased-heart-rate) around 3pm. Bellabeat could improve the wellness and quality of individual's day by **sending their users a reminder** to take a short walk or do a quick 5 minute mindfulness mediation around 1pm or 2pm to stave of the 3pm tiredness. This would enable users to refocus and allow people to become more productive as a result of Bellabeat's product.


Based on the frequency graphs, I would recommend researching a way to get the users of Bellabeat's Time product to become more physically active. I make this recommendation based on the above data, and because only about 22% of people nationally met the national weekly fitness guidelines [(CDC)](https://www.cdc.gov/nchs/data/nhsr/nhsr112.pdf). 

This could mean offering **new products** to build the Bellabeat ecosystem/ community which could include creating a smart scale, branded fitness equipment such as yoga and spin class gear, and even having after work or Saturday (paid or unpaid) **community fitness classes** put on by Bellabeat. I suggest after work (around 6pm Monday through Friday) and around noon on Saturday because the data indicates people are already more physically active during those times and would likely be more willing to join a class during those times.

All these would fit in with the lifestyle and wellness focused culture that Bellabeat provides as well as creates a sense of community and brand loyalty to Bellabeat.


